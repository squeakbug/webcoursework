# Балансировка

Проведение "нагрузочного" тестирования:

Сбор данных выполнялся следующим образом:
- Для каждой конфигурации (с 1 и 3 проксируемыми серверами)
 тест запускался для значений (10, 1000), (100, 1000) и (100, 10000),
 где первое значение в скобках --- количество одновременных соединений, 
 а второе --- общее количество запросов

Ниже приведены результаты тестирования:

1) Запущен один проксируемый сервер:
![1](img/c10_n1000.PNG)
![2](img/c100_n1000.PNG)
![3](img/c100_n10000.PNG)

2) Запущено три проксируемых сервера:
![1](img/c10_n1000s.PNG)
![2](img/c100_n1000s.PNG)
![3](img/c100_n10000s.PNG)

Для доказательства работы балансирования в заголовок http-ответа добавлено поле
X-Upstream, содержащее указание на проксируемый сервер:
production1, production2 или production3

После отправки пяти запросов получим следующий результат:

![Заголовок первого ответа](img/response_001.PNG)
![Заголовок второго ответа](img/response_002.PNG)
![Заголовок третьего ответа](img/response_003.PNG)
![Заголовок четвертого ответа](img/response_004.PNG)
![Заголовок пятого ответа](img/response_005.PNG)

Как видим, первый хост получил два запроса, потом остальные по одному.
Затем цикл повторяется.

# Cool HTTP/2

Для демонстрации работы ServerPush и Preload возможностей используется утилита nghttp:

```sh
nghttp -ans https://proxy_server_ip/legacy
```

![До изменения конфигураций](img/before_anything.jpg)
![После добавления Link заголовка в http/2 сообщения](img/after_link.jpg)
![После добавление link тега](img/after_preload.jpg)
